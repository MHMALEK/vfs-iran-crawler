(()=>{"use strict";var t={93:(t,e,a)=>{a.r(e),a.d(e,{captchaDefaultType:()=>o,default:()=>n});const o="ImageToTextTask",n={CREATE_TASK:"createTask",GET_TASK:"getTaskResult"}},167:t=>{t.exports=require("axios")},185:t=>{t.exports=require("mongoose")},311:t=>{t.exports=require("node-cron")},159:t=>{t.exports=require("node-telegram-bot-api")},828:t=>{t.exports=require("puppeteer-extra")},199:t=>{t.exports=require("puppeteer-extra-plugin-stealth")}},e={};function a(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,a),r.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=require("dotenv"),e=require("express");var o=a.n(e);const n={headless:!1,args:["--user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36"]},r=a(828),s=a(199);r.use(s());const c=async({headless:t,args:e}=n)=>await r.launch({headless:t,args:e}),i=async t=>await t.waitForXPath('//*[contains(text(), "Your estimated wait time")]',{timeout:1e4}).then((async()=>{if(null!==queueText)return await queueText.evaluate((t=>t.innerHTML))})).catch((t=>new Error)),l=a(167),{default:w,captchaDefaultType:u}=a(93),p=async t=>{try{return await t.$("#logoutForm  > a > span"),await t.click("#logoutForm  > a > span"),!1}catch{return!0}},d=async()=>{const t=await c(),e=await t.newPage();try{if(await(async t=>await t.goto("https://online.vfsglobal.com/Global-Appointment/Account/RegisteredLogin?q=shSA0YnE4pLF9Xzwon/x/MI24mBrB3J1rBC1vdDKa5IQdrJXKYTs+DdVJBpH9l4l7y9kr9wkS1P1QdJpp0GPog=="))(e),await(async t=>i().then((()=>!0)).catch((()=>!1)))()){const t=i();throw new Error(t)}const t=await(async t=>{const e=await(async t=>{await t.waitForSelector("#CaptchaImage");const e=await t.$("#CaptchaImage");return await e.screenshot({path:"captcha.png",encoding:"base64"})})(t);return await(t=>new Promise((async(e,a)=>{try{const a=await(async t=>await l.post(`https://api.anycaptcha.com/${w.CREATE_TASK}`,{clientKey:"41922ef06402437ca348e785a4f6df05",task:{type:u,body:t}}).then((t=>t.data.taskId)).catch((t=>{throw new Error("ERROR_TYPES.SUBMIT_CPATCH_TO_RESOLVER_SERVER_ERROR")})))(t),o=setInterval((async()=>{const t=await(async t=>await l.post(`https://api.anycaptcha.com/${w.GET_TASK}`,{clientKey:"41922ef06402437ca348e785a4f6df05",taskId:t}).then((async t=>t.data)).catch((t=>{throw new Error(t)})))(a);"ready"===t.status&&(clearInterval(o),e(t.solution.text))}),3e3)}catch(t){a(t)}})))(e)})(e);await(async(t,e)=>{await t.type("#EmailId","mhos.malek@gmail.com"),await t.type("#Password","w6#rtCpbzkUw"),await t.type("#CaptchaInputText",e.toUpperCase())})(e,t),await Promise.all([e.click("#btnSubmit"),e.waitForNavigation({waitUntil:"networkidle2"})]);const a=await e.$("#ApplicantListForm > div.validation-summary-errors > ul > li");if(a){const t=await a.evaluate((t=>t.textContent));throw new Error(t)}await(async t=>{try{const e=await(async t=>{try{return await t.$("#Accordion1 > div > div.AccordionPanelContent > div > ul > li:nth-child(2) > a")}catch(t){throw new Error(t)}})(t);return await Promise.all([e.click(),t.waitForNavigation({waitUntil:"networkidle2"})])}catch(t){throw new Error(t)}})(e),await(async t=>{try{return await t.select("select[name='LocationId']","220")}catch(t){throw new Error(t)}})(e);const o=await((t,e="Account/CheckSeatAllotment")=>new Promise(((a,o)=>{try{t.on("response",(async t=>{if(t.request().url().includes(e)){const e=await t.json();return JSON.stringify(e).includes("no seat")?a(e):(console.log("responseFromEndpoint",e),a("Appointment is Availble! Get it soon!"))}}))}catch(t){return o(t)}})))(e);return await p(e),o}catch(t){throw await p(e),new Error(t)}},h=d,y=async(t,e,a)=>{try{const t=await h();e.send(t)}catch(t){console.log(t)}},g=a(185),m=new g.Schema({chatId:{type:Number,unique:!0}}),f=g.model("user",m),v=f,E=new(a(159))("5239349771:AAGsVEHuyJ7NZ_DOBQeMBtaVYjrPWZhq3E4",{polling:!0}),T=async t=>{try{await(async t=>{const e=await(async t=>await f.findOne({chatId:t}))(t);return!!e})(t)||new v({chatId:t}).save()}catch(t){throw new Error("can not save user to database")}},b=(t,e)=>{console.log("telegramBotController")},x=a(185),A=a(311),S={expression:"0 12 * * *",callBack:()=>console.log("executed on a schedule!")},k=(t,e,a,o)=>{const n=t.statusCode||500;console.log("asdsad",t),a.status(n).json({message:t})};t.config();const P=process.env.PORT||3e3;E.on("message",(t=>{const e=t.chat.id;T(e)})),(({callBack:t,expression:e}=S)=>{const a=A.schedule(e,t);return a.start(),{start:()=>a.start(),stop:()=>a.stop}})({expression:S.expression,callBack:async()=>{try{const t=await d();sendMessageToAllUsers(t)}catch(t){throw console.log(t),new Error(t)}}}).start(),(()=>{const t=o()();t.use((0,e.json)()),(()=>{try{const t="mongodb+srv://vfs-data-base-user:or4m4PZfozvioH7m@cluster0.ygtsbho.mongodb.net/test";x.connect(t);const e=x.connection;e.on("error",(t=>{throw console.log(t),new Error("can not connect to database")})),e.once("connected",(()=>(console.log("Database Connected"),e)))}catch(t){}})(),t.get("/",y),t.get("/start-bot",b),t.use(k),t.listen(P,(()=>console.log(`App listening at port ${P}`)))})()})()})();