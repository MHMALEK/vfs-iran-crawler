(()=>{"use strict";var e={394:e=>{e.exports=require("@infosimples/node_two_captcha")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},311:e=>{e.exports=require("node-cron")},828:e=>{e.exports=require("puppeteer-extra")},199:e=>{e.exports=require("puppeteer-extra-plugin-stealth")},745:e=>{e.exports=require("rollbar")},807:e=>{e.exports=require("user-agents")}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("dotenv"),t=require("express");var o=a.n(t);const r=require("helmet");var n=a.n(r);const s=new(a(807))({deviceCategory:"desktop",platform:"Linux x86_64"});console.log("production","process.env.NODE_ENV"),console.log(";randomUserAgent",s.data.userAgent);const c={headless:!0,args:[s.data.userAgent,"--no-sandbox","--disable-setuid-sandbox"]},i=a(828),l=a(199);i.use(l());const u=async({headless:e,args:t}=c)=>await i.launch({headless:!1}),w=async e=>await e.waitForXPath('//*[contains(text(), "Your estimated wait time")]',{timeout:1e4}).then((async()=>{if(null!==queueText)return await queueText.evaluate((e=>e.innerHTML))})).catch((e=>new Error)),d=a(394),p=async e=>{try{return await e.$("#logoutForm  > a > span"),await e.click("#logoutForm  > a > span"),!1}catch{return!0}},h={GO_TO_LOGIN_PAGE:{id:0,label:"Go to login page",succesfull:!1},GET_CAPTCHA:{id:1,label:"Get Captcha Image",succesfull:!1},RESOLVE_CAPTCHA:{id:2,label:"Resolve Captch Image by Third Party App",succesfull:!1},ENTER_LOGIN_DETAILS:{id:3,label:"Enter Login details",succesfull:!1},LOGIN_ACTION:{id:4,label:"Login to VFS successfully",succesfull:!1},SELECT_LOCATION:{id:5,label:"Select location",succesfull:!1}},g=async()=>{const e=await u(),t=await e.newPage();try{if(await(async e=>{try{return await e.goto("https://row7.vfsglobal.com/Global-Appointment/Account/RegisteredLogin?q=shSA0YnE4pLF9Xzwon/x/MI24mBrB3J1rBC1vdDKa5IQdrJXKYTs+DdVJBpH9l4l7y9kr9wkS1P1QdJpp0GPog==",{waitUntil:"load",timeout:0})}catch(e){console.log("vvvvv",e)}})(t),await(async e=>w().then((()=>!0)).catch((()=>!1)))()){const e=w();throw h.GO_TO_LOGIN_PAGE.succesfull=!1,new Error(e)}h.GO_TO_LOGIN_PAGE.succesfull=!0,console.log("44444");const a=await(async e=>{const t=await(async e=>{await e.waitForSelector("#CaptchaImage");const t=await e.$("#CaptchaImage");console.log("77777",t);const a=await t.screenshot({encoding:"base64"});return console.log("88888",a),a})(e);console.log("99999",t);const a=await(async e=>{const t=new d("0e819916b2290052cd066c68014a4282",{timeout:6e4,polling:5e3,throwErrors:!1});return(await t.decode({base64:e})).text})(t);return console.log("100000",a),a})(t);h.GET_CAPTCHA.succesfull=!0,await(async(e,t)=>{await e.type("#EmailId","mhos.malek+2@gmail.com"),await e.type("#Password","QR7NpXSD8@PmdME"),await e.type("#CaptchaInputText",t.toUpperCase())})(t,a),await Promise.all([t.click("#btnSubmit"),t.waitForNavigation({waitUntil:"networkidle2"})]),h.RESOLVE_CAPTCHA.succesfull=!0,(async e=>{const t=await(void 0).$("#ApplicantListForm > div.validation-summary-errors > ul > li");if(t){const e=await t.evaluate((e=>e.textContent));throw h.LOGIN_ACTION.succesfull=!1,new Error(e)}})(),h.LOGIN_ACTION.succesfull=!0,await(async e=>{try{const t=await(async e=>{try{return await e.$("#Accordion1 > div > div.AccordionPanelContent > div > ul > li:nth-child(2) > a")}catch(e){throw new Error(e)}})(e);return await Promise.all([t.click(),e.waitForNavigation({waitUntil:"networkidle2"})])}catch(e){throw new Error(e)}})(t),await(async e=>{try{return await e.select("select[name='LocationId']","220")}catch(e){throw new Error(e)}})(t),h.SELECT_LOCATION.succesfull=!0,await(async e=>{try{return await e.select("select[name='VisaCategoryId']","4887")}catch(e){throw new Error(e)}})(t);const o=await((e,t="Account/CheckSeatAllotment")=>new Promise(((a,o)=>{try{e.on("response",(async e=>{if(e.request().url().includes(t)){const t=await e.json();return JSON.stringify(t).includes("no seat")?a(!1):a(!0)}}))}catch(e){return o(e)}})))(t);let r;return o&&(console.log("1111"),r=await(async e=>await e.waitForXPath("/html/body/div[2]/div[1]/div[3]/div[3]/form/div[1]/div[2]/div[7]/div[6]/div/table/thead/tr[2]/td[1]/label[2]",{timeout:1e4}).then((async e=>{if(console.log("asdsadsad",e),null!==e){const t=await e.evaluate((e=>e.innerHTML));return console.log("appointmetntTimeText",t),t}})).catch((e=>new Error)))(t),console.log("time",r)),await p(t),await e.close(),`Soonest available appointment for VFS is ${r}`}catch(a){throw await p(t),await e.close(),console.log("eeeeee",a),new Error(a)}},y=g,m=async(e,t,a)=>{try{const e=await y();t.send(e)}catch(e){throw a(e),new Error(e)}},v=a(311),E={expression:"0 12 * * *",callBack:()=>console.log("executed on a schedule!")},f=a(745),x=async(e,t,a)=>{try{t.send("this app is a simple robot to help you find and make appointment in VFS global in Iran!!!")}catch(e){throw a(e),new Error(e)}};e.config();const A=a(455);var b=a(582);const T=new f({accessToken:"a448a0ece2324e8eb5a4273565a815ee",captureUncaught:!0,captureUnhandledRejections:!0}),C=[t.json,n(),A,T.errorHandler,b];(({callBack:e,expression:t}=E)=>{const a=v.schedule(t,e);a.start()})({expression:E.expression,callBack:async()=>{try{await g()}catch(e){throw new Error(e)}}}),(()=>{const e=o()();(e=>{C.map((t=>e.use(t())))})(e),e.get("/",x),e.get("/check-appointment",m),e.listen("3003",(()=>console.log("App listening at port 3003")))})()})()})();