(()=>{"use strict";var e={394:e=>{e.exports=require("@infosimples/node_two_captcha")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},185:e=>{e.exports=require("mongoose")},311:e=>{e.exports=require("node-cron")},159:e=>{e.exports=require("node-telegram-bot-api")},828:e=>{e.exports=require("puppeteer-extra")},199:e=>{e.exports=require("puppeteer-extra-plugin-stealth")},745:e=>{e.exports=require("rollbar")},807:e=>{e.exports=require("user-agents")}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("dotenv"),t=require("express");var a=o.n(t);const r=require("helmet");var n=o.n(r);const s=new(o(807))({deviceCategory:"desktop",platform:"Linux x86_64"});console.log("production","process.env.NODE_ENV"),console.log(";randomUserAgent",s.data.userAgent);const c={headless:!0,args:[s.data.userAgent,"--no-sandbox","--disable-setuid-sandbox"]},i=o(828),l=o(199);i.use(l());const p=async({headless:e,args:t}=c)=>await i.launch({headless:e,args:t}),u=async e=>await e.waitForXPath('//*[contains(text(), "Your estimated wait time")]',{timeout:1e4}).then((async()=>{if(null!==queueText)return await queueText.evaluate((e=>e.innerHTML))})).catch((e=>new Error)),w=o(394),d=o(185),g=new d.Schema({chatId:{type:Number,unique:!0}}),h=(d.model("user",g),o(159));var m;m="5239349771:AAFyXLVcm9tPbaM_YYZN0gjqk-7A6CpLD8M",console.log(m),new h(m,{polling:!0});const y=async()=>{const e=await p(),t=await e.newPage();try{if(console.log("22222"),await(async e=>{console.log("6666",e.goto);try{return await e.goto("https://row7.vfsglobal.com/Global-Appointment/Account/RegisteredLogin?q=shSA0YnE4pLF9Xzwon/x/MI24mBrB3J1rBC1vdDKa5IQdrJXKYTs+DdVJBpH9l4l7y9kr9wkS1P1QdJpp0GPog==",{waitUntil:"load",timeout:0})}catch(e){console.log("vvvvv",e)}})(t),console.log("33333"),await(async e=>u().then((()=>!0)).catch((()=>!1)))()){const e=u();throw new Error(e)}console.log("44444");const e=await(async e=>{const t=await(async e=>{await e.waitForSelector("#CaptchaImage");const t=await e.$("#CaptchaImage");console.log("77777",t);const o=await t.screenshot({encoding:"base64"});return console.log("88888",o),o})(e);console.log("99999",t);const o=await(async e=>{const t=new w("0e819916b2290052cd066c68014a4282",{timeout:6e4,polling:5e3,throwErrors:!1});return(await t.decode({base64:e})).text})(t);return console.log("100000",o),o})(t);return console.log("55555",e),await(async(e,t)=>{await e.type("#EmailId","mhos.malek+2@gmail.com"),await e.type("#Password","QR7NpXSD8@PmdME"),await e.type("#CaptchaInputText",t.toUpperCase())})(t,e),await Promise.all([t.click("#btnSubmit"),t.waitForNavigation({waitUntil:"networkidle2"})]),(async e=>{const t=await(void 0).$("#ApplicantListForm > div.validation-summary-errors > ul > li");if(t){const e=await t.evaluate((e=>e.textContent));throw new Error(e)}})(),await(async e=>{try{const t=await(async e=>{try{return await e.$("#Accordion1 > div > div.AccordionPanelContent > div > ul > li:nth-child(2) > a")}catch(e){throw new Error(e)}})(e);return await Promise.all([t.click(),e.waitForNavigation({waitUntil:"networkidle2"})])}catch(e){throw new Error(e)}})(t),await(async e=>{try{return await e.select("select[name='LocationId']","220")}catch(e){throw new Error(e)}})(t),await((e,t="Account/CheckSeatAllotment")=>new Promise(((o,a)=>{try{e.on("response",(async e=>{if(e.request().url().includes(t)){const t=await e.json();return JSON.stringify(t).includes("no seat")?o(t):(console.log("responseFromEndpoint",t),o("Appointment is Availble! Get it soon!"))}}))}catch(e){return a(e)}})))(t),await(async e=>{try{return await e.$("#logoutForm  > a > span"),await e.click("#logoutForm  > a > span"),!1}catch{return!0}})(t),"finalResult"}catch(e){throw console.log("eeeeee",e),new Error(e)}},x=y,v=async(e,t,o)=>{try{const e=await x();t.send(e)}catch(e){throw o(e),new Error(e)}},b=(o(185),o(311)),q={expression:"0 12 * * *",callBack:()=>console.log("executed on a schedule!")},k=o(745),A=async(e,t,o)=>{try{t.send("this app is a simple robot to help you find and make appointment in VFS global in Iran!!!")}catch(e){throw o(e),new Error(e)}};e.config();const E=o(455);var f=o(582);const P=new k({accessToken:"a448a0ece2324e8eb5a4273565a815ee",captureUncaught:!0,captureUnhandledRejections:!0}),F=[t.json,n(),E,P.errorHandler,f];(({callBack:e,expression:t}=q)=>{const o=b.schedule(t,e);o.start()})({expression:q.expression,callBack:async()=>{try{await y()}catch(e){throw new Error(e)}}}),(()=>{const e=a()();(e=>{F.map((t=>e.use(t())))})(e),e.get("/",A),e.get("/check-appointment",v),e.listen("3003",(()=>console.log("App listening at port 3003")))})()})()})();