(()=>{"use strict";var e={394:e=>{e.exports=require("@infosimples/node_two_captcha")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},311:e=>{e.exports=require("node-cron")},828:e=>{e.exports=require("puppeteer-extra")},199:e=>{e.exports=require("puppeteer-extra-plugin-stealth")},745:e=>{e.exports=require("rollbar")},807:e=>{e.exports=require("user-agents")}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("dotenv"),t=require("express");var o=a.n(t);const r=require("helmet");var n=a.n(r);const s=new(a(807))({deviceCategory:"desktop",platform:"Linux x86_64"});console.log("production","process.env.NODE_ENV"),console.log(";randomUserAgent",s.data.userAgent);const c={headless:!0,args:[s.data.userAgent,"--no-sandbox","--disable-setuid-sandbox"]},i=a(828),l=a(199);i.use(l());const p=async({headless:e,args:t}=c)=>await i.launch({headless:e,args:t}),u=async e=>await e.waitForXPath('//*[contains(text(), "Your estimated wait time")]',{timeout:1e4}).then((async()=>{if(null!==queueText)return await queueText.evaluate((e=>e.innerHTML))})).catch((e=>new Error)),w=a(394),d=async()=>{const e=await p(),t=await e.newPage();try{if(console.log("22222"),await(async e=>{console.log("6666",e.goto);try{return await e.goto("https://row7.vfsglobal.com/Global-Appointment/Account/RegisteredLogin?q=shSA0YnE4pLF9Xzwon/x/MI24mBrB3J1rBC1vdDKa5IQdrJXKYTs+DdVJBpH9l4l7y9kr9wkS1P1QdJpp0GPog==",{waitUntil:"load",timeout:0})}catch(e){console.log("vvvvv",e)}})(t),console.log("33333"),await(async e=>u().then((()=>!0)).catch((()=>!1)))()){const e=u();throw new Error(e)}console.log("44444");const e=await(async e=>{const t=await(async e=>{await e.waitForSelector("#CaptchaImage");const t=await e.$("#CaptchaImage");console.log("77777",t);const a=await t.screenshot({encoding:"base64"});return console.log("88888",a),a})(e);console.log("99999",t);const a=await(async e=>{const t=new w("0e819916b2290052cd066c68014a4282",{timeout:6e4,polling:5e3,throwErrors:!1});return(await t.decode({base64:e})).text})(t);return console.log("100000",a),a})(t);return console.log("55555",e),await(async(e,t)=>{await e.type("#EmailId","mhos.malek+2@gmail.com"),await e.type("#Password","QR7NpXSD8@PmdME"),await e.type("#CaptchaInputText",t.toUpperCase())})(t,e),await Promise.all([t.click("#btnSubmit"),t.waitForNavigation({waitUntil:"networkidle2"})]),(async e=>{const t=await(void 0).$("#ApplicantListForm > div.validation-summary-errors > ul > li");if(t){const e=await t.evaluate((e=>e.textContent));throw new Error(e)}})(),await(async e=>{try{const t=await(async e=>{try{return await e.$("#Accordion1 > div > div.AccordionPanelContent > div > ul > li:nth-child(2) > a")}catch(e){throw new Error(e)}})(e);return await Promise.all([t.click(),e.waitForNavigation({waitUntil:"networkidle2"})])}catch(e){throw new Error(e)}})(t),await(async e=>{try{return await e.select("select[name='LocationId']","220")}catch(e){throw new Error(e)}})(t),await((e,t="Account/CheckSeatAllotment")=>new Promise(((a,o)=>{try{e.on("response",(async e=>{if(e.request().url().includes(t)){const t=await e.json();return JSON.stringify(t).includes("no seat")?a(t):(console.log("responseFromEndpoint",t),a("Appointment is Availble! Get it soon!"))}}))}catch(e){return o(e)}})))(t),await(async e=>{try{return await e.$("#logoutForm  > a > span"),await e.click("#logoutForm  > a > span"),!1}catch{return!0}})(t),"finalResult"}catch(e){throw console.log("eeeeee",e),new Error(e)}},h=d,g=async(e,t,a)=>{try{const e=await h();t.send(e)}catch(e){throw a(e),new Error(e)}},m=a(311),y={expression:"0 12 * * *",callBack:()=>console.log("executed on a schedule!")},x=a(745),v=async(e,t,a)=>{try{t.send("this app is a simple robot to help you find and make appointment in VFS global in Iran!!!")}catch(e){throw a(e),new Error(e)}};e.config();const b=a(455);var E=a(582);const f=new x({accessToken:"a448a0ece2324e8eb5a4273565a815ee",captureUncaught:!0,captureUnhandledRejections:!0}),k=[t.json,n(),b,f.errorHandler,E];(({callBack:e,expression:t}=y)=>{const a=m.schedule(t,e);a.start()})({expression:y.expression,callBack:async()=>{try{await d()}catch(e){throw new Error(e)}}}),(()=>{const e=o()();(e=>{k.map((t=>e.use(t())))})(e),e.get("/",v),e.get("/check-appointment",g),e.listen("3003",(()=>console.log("App listening at port 3003")))})()})()})();