(()=>{"use strict";var e={93:(e,t,a)=>{a.r(t),a.d(t,{captchaDefaultType:()=>r,default:()=>n});const r="ImageToTextTask",n={CREATE_TASK:"createTask",GET_TASK:"getTaskResult"}},167:e=>{e.exports=require("axios")},142:e=>{e.exports=require("dotenv")},159:e=>{e.exports=require("node-telegram-bot-api")},828:e=>{e.exports=require("puppeteer-extra")},199:e=>{e.exports=require("puppeteer-extra-plugin-stealth")}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=require("express");var t=a.n(e);process.env.VFS_BASE_URL,process.env.VFS_USER_NAME,process.env.VFS_PASSWORD;const r=a(828),n=a(199);r.use(n());const o=async({headless:e,args:t}={headless:!1,args:["--user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36"]})=>await r.launch({headless:e,args:t}),s=async e=>await e.waitForXPath('//*[contains(text(), "Your estimated wait time")]',{timeout:1e4}).then((async()=>{if(null!==queueText)return await queueText.evaluate((e=>e.innerHTML))})).catch((e=>new Error)),c={status:500,message:"could not send it to resolver server"},i=a(167),{default:l,captchaDefaultType:p}=a(93),w=a(159),u=async e=>{try{return await e.$("#logoutForm  > a > span"),await e.click("#logoutForm  > a > span"),!1}catch{return!0}};a(142).config();const d=t()();d.use((0,e.json)());const y=((e=process.env.TELEGRAM_BOT_TOKEN)=>(console.log(e),new w(e,{polling:!0})))(),h=process.env.PORT||3e3;d.get("/",(async(e,t)=>{const a=await o(),r=await a.newPage();try{if(await(async e=>await e.goto(process.env.VFS_BASE_URL))(r),await(async e=>s().then((()=>!0)).catch((()=>!1)))()){const e=s();throw new Error(e)}const e=await(async e=>{const t=await(async e=>{await e.waitForSelector("#CaptchaImage");const t=await e.$("#CaptchaImage");return await t.screenshot({path:"captcha.png",encoding:"base64"})})(e);return await(e=>new Promise((async(t,a)=>{try{const a=await(async e=>await i.post(`${process.env.CAPTCHA_SERVER_BASE_API}/${l.CREATE_TASK}`,{clientKey:process.env.CAPTCHA_SERVER_API_TOKEN,task:{type:p,body:e}}).then((e=>e.data.taskId)).catch((e=>{throw new Error(c)})))(e),r=setInterval((async()=>{const e=await(async e=>await i.post(`${process.env.CAPTCHA_SERVER_BASE_API}/${l.GET_TASK}`,{clientKey:process.env.CAPTCHA_SERVER_API_TOKEN,taskId:e}).then((async e=>e.data)).catch((e=>{throw new Error(e)})))(a);"ready"===e.status&&(clearInterval(r),t(e.solution.text))}),3e3)}catch(e){a(e)}})))(t)})(r);await(async(e,t)=>{await e.type("#EmailId",process.env.VFS_USER_NAME),await e.type("#Password",process.env.VFS_PASSWORD),await e.type("#CaptchaInputText",t.toUpperCase())})(r,e),await Promise.all([r.click("#btnSubmit"),r.waitForNavigation({waitUntil:"networkidle2"})]);const a=await r.$("#ApplicantListForm > div.validation-summary-errors > ul > li");if(a){const e=await a.evaluate((e=>e.textContent));throw console.log(a,e),new Error(e)}await(async e=>{try{const t=await(async e=>{try{return await e.$("#Accordion1 > div > div.AccordionPanelContent > div > ul > li:nth-child(2) > a")}catch(e){throw new Error(e)}})(e);return console.log("dsad",t),await Promise.all([t.click(),e.waitForNavigation({waitUntil:"networkidle2"})])}catch(e){throw new Error(e)}})(r),await(async e=>{try{return await e.select("select[name='LocationId']","220")}catch(e){throw new Error(e)}})(r);const n=await((e,t="Account/CheckSeatAllotment")=>new Promise(((a,r)=>{try{e.on("response",(async e=>{if(e.request().url().includes(t)){const t=await e.json();return JSON.stringify(t).includes("no seat")?a(t):(console.log("responseFromEndpoint",t),a("seat is availble"))}}))}catch(e){return r(e)}})))(r);y.sendMessage(1949747267,n),await u(r),t.send(n)}catch(e){console.log(e),y.sendMessage(1949747267,`Error: ${e}`),await u(r),t.send("errors")}})),d.listen(h,(()=>console.log(`App listening at port ${h}`)))})()})();